<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TrendAgent Daily Radar</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; background: #f4f7f9; margin: 20px; color: #333; line-height: 1.5; }
        h2 { margin-top: 0; color: #1a1a1a; }
        table { width: 100%; border-collapse: collapse; background: white; font-size: 13px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden; margin-top: 15px; }
        th, td { padding: 12px 10px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f8f9fa; color: #666; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; position: sticky; top: 0; }
        
        /* R√¶kker & Status */
        .active-row { background: #fffde7; border-left: 5px solid #fbc02d; font-weight: 500; }
        .bull { color: #28a745; font-weight: bold; }
        .bear { color: #d93025; font-weight: bold; }
        
        /* Badges fra din gamle kode (robusthed) */
        .badge { padding: 2px 6px; border-radius: 6px; font-size: 11px; font-weight: bold; color: white; }
        .b-up { background: #28a745; }
        .b-down { background: #d93025; }

        .footer-note { margin-top: 20px; font-size: 12px; color: #666; font-style: italic; }
    </style>
</head>
<body>
    <div>
        <h2>üöÄ TrendAgent Daily Fokus</h2>
        <small>K√∏rselsdato: {{ timestamp }}</small>
    </div>

    <table>
        <thead>
            <tr>
                <th></th>
                <th>Fond</th>
                <th>Signal</th>
                <th>Egen %</th>
                <th>Trend</th>
                <th>MA200 %</th>
                <th>Cross</th>
                <th>1D %</th>
                <th>DD</th>
            </tr>
        </thead>
        <tbody>
            {% for f in funds %}
            <tr class="{{ 'active-row' if f.is_active else '' }}">
                <td>{{ '‚≠ê' if f.is_active else 'üîç' }}</td>
                <td>{{ f.name[:35] }}</td>
                
                <td style="font-weight:bold; color: {{ '#1a73e8' if 'K√òB' in f.signal else '#d93025' if 'SALG' in f.signal else '#666' }}">
                    {{ f.signal }}
                </td>

                <td style="font-weight:bold; color: {{ '#28a745' if (f.total_return or 0) > 0 and f.day_chg >= 0 else '#d93025' if f.total_return is not none else '#666' }}">
                    {{ '%+.1f'|format(f.total_return) if f.total_return is not none else '‚Äì' }}%
                </td>

                <td>
                    <span class="badge {{ 'b-up' if f.t_state == 'BULL' else 'b-down' }}">
                        {{ f.t_state }}
                    </span>
                </td>

                <td style="font-weight:bold;">{{ '%+.1f'|format(f.dist_ma200) }}%</td>
                <td>{{ f.cross_20_50 }}</td>
                <td style="color: {{ '#28a745' if f.day_chg > 0 else '#d93025' }}">{{ '%+.2f'|format(f.day_chg) }}%</td>
                <td style="color:#d93025">{{ '%.1f'|format(f.drawdown) }}%</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="9" style="text-align:center; padding: 30px; color: #666;">
                    <em>Ingen data tilg√¶ngelig. Tjek om latest.json er opdateret.</em>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="footer-note">
        <strong>Metodik:</strong> Rapporten bruger MA200 til trend-identifikation. 
        Total % lyser <span style="color: #d93025;">r√∏dt</span> hvis fonden taber terr√¶n (negativ 1D √¶ndring), selvom det samlede afkast er positivt.
    </div>
</body>
</html>
